<!DOCTYPE html>
<html lang="th">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
Â  Â  <title>à¸ à¸²à¸£à¸à¸´à¸ˆà¸¥à¸”à¸„à¸²à¸£à¹Œà¸šà¸­à¸™ | à¹€à¸à¸¡à¸¡à¸·à¸­à¸–à¸·à¸­</title>
Â  Â Â 
Â  Â  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
Â  Â Â 
Â  Â  <script type="module">
Â  Â  Â  Â  // --- Firebase Core Imports ---
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
Â  Â  Â  Â  import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
Â  Â  Â  Â  import {Â 
Â  Â  Â  Â  Â  Â  getFirestore,Â 
Â  Â  Â  Â  Â  Â  addDoc,Â 
Â  Â  Â  Â  Â  Â  onSnapshot,Â 
Â  Â  Â  Â  Â  Â  collection,Â 
Â  Â  Â  Â  Â  Â  query,Â 
Â  Â  Â  Â  Â  Â  orderBy,
Â  Â  Â  Â  Â  Â  setLogLevelÂ 
Â  Â  Â  Â  } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

Â  Â  Â  Â  // *******************************************************************
Â  Â  Â  Â  // ğŸš¨ à¸ªà¸³à¸„à¸±à¸à¸¡à¸²à¸: à¸à¸£à¸¸à¸“à¸²à¹à¸—à¸™à¸—à¸µà¹ˆà¸„à¹ˆà¸²à¹€à¸«à¸¥à¹ˆà¸²à¸™à¸µà¹‰à¸”à¹‰à¸§à¸¢ Firebase Config à¸‚à¸­à¸‡à¸„à¸¸à¸“Â 
Â  Â  Â  Â  // *******************************************************************
Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyDmjcXHZz3glB6hffzsgZeVzpMx48FutXw",
Â  Â  Â  Â  Â  Â  authDomain: "game-8ad3f.firebaseapp.com",
Â  Â  Â  Â  Â  Â  projectId: "game-8ad3f",
Â  Â  Â  Â  Â  Â  storageBucket: "game-8ad3f.firebasestorage.app",
Â  Â  Â  Â  Â  Â  messagingSenderId: "1076950258243",
Â  Â  Â  Â  Â  Â  appId: "1:1076950258243:web:e65a0ac6f51aa9bc4b3af6",
Â  Â  Â  Â  Â  Â  measurementId: "G-0M2L8HX0D2"
Â  Â  Â  Â  };
Â  Â  Â  Â  // *******************************************************************
Â  Â  Â  Â Â 
Â  Â  Â  Â  setLogLevel('Debug');

Â  Â  Â  Â  const appId = firebaseConfig.appId;
Â  Â  Â  Â  let db;
Â  Â  Â  Â  let auth;
Â  Â  Â  Â  let userId = null;

Â  Â  Â  Â  function notifyAppReady() {
Â  Â  Â  Â  Â  Â  window.initApp(userId, appId);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.firestore = {
Â  Â  Â  Â  Â  Â  collection,
Â  Â  Â  Â  Â  Â  addDoc,
Â  Â  Â  Â  Â  Â  onSnapshot,
Â  Â  Â  Â  Â  Â  query,
Â  Â  Â  Â  Â  Â  orderBy
Â  Â  Â  Â  };

Â  Â  Â  Â  if (firebaseConfig.projectId && firebaseConfig.apiKey && firebaseConfig.apiKey !== "YOUR_API_KEY_HERE") {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  Â  Â  Â  Â  db = getFirestore(app);
Â  Â  Â  Â  Â  Â  Â  Â  auth = getAuth(app);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  window.db = db;Â 

Â  Â  Â  Â  Â  Â  Â  Â  async function attemptSignIn() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await signInAnonymously(auth);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Authentication process failed:", error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  attemptSignIn();

Â  Â  Â  Â  Â  Â  Â  Â  onAuthStateChanged(auth, (user) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId = user.uid;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  notifyAppReady();Â 
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Firebase Initialization Failed:", e);
Â  Â  Â  Â  Â  Â  Â  Â  notifyAppReady();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  notifyAppReady();
Â  Â  Â  Â  }
Â  Â  </script>

Â  Â  <style>
Â  Â  Â  Â  /* ------------------------------------------------------------------- */
Â  Â  Â  Â  /* --- CORE LAYOUT & NEUMORPHISM THEME (Bootstrap Integration) --- */
Â  Â  Â  Â  /* ------------------------------------------------------------------- */
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;700&display=swap');
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* CSS Variables for Theme */
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --bg-color: #ecfdf5; /* Light Mint/Green Base */
Â  Â  Â  Â  Â  Â  --primary-color: #047857; /* Dark Emerald */
Â  Â  Â  Â  Â  Â  --secondary-color: #67e8f9; /* Cyan */
Â  Â  Â  Â  Â  Â  --text-color: #15803d; /* Darker Green for text */
Â  Â  Â  Â  Â  Â  --shadow-light: #ffffff;
Â  Â  Â  Â  Â  Â  --shadow-dark: #dbece0;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Base Setup */
Â  Â  Â  Â  html, body {Â 
Â  Â  Â  Â  Â  Â  height: 100%;Â 
Â  Â  Â  Â  Â  Â  overflow: hidden;Â 
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  Â  Â  font-family: 'Chakra Petch', sans-serif;
Â  Â  Â  Â  Â  Â  background-color: var(--bg-color);Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  -webkit-font-smoothing: antialiased;
Â  Â  Â  Â  Â  Â  -moz-osx-font-smoothing: grayscale;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* App Container - Crucial for Mobile Responsive */
Â  Â  Â  Â  #app {
Â  Â  Â  Â  Â  Â  width: 100vw;
Â  Â  Â  Â  Â  Â  height: 100vh;
Â  Â  Â  Â  Â  Â  max-width: 600px;Â 
Â  Â  Â  Â  Â  Â  background-color: var(--bg-color);Â 
Â  Â  Â  Â  Â  Â  padding: 1rem;Â 
Â  Â  Â  Â  Â  Â  box-sizing: border-box;Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  /* à¹€à¸§à¹‰à¸™à¸£à¸°à¸¢à¸° Header à¸ˆà¸²à¸à¸‚à¸­à¸šà¸šà¸™à¸‚à¸­à¸‡à¸¡à¸·à¸­à¸–à¸·à¸­ */
Â  Â  Â  Â  Â  Â  padding-top: 1.5rem;Â 
Â  Â  Â  Â  Â  Â  padding-top: calc(1.5rem + env(safe-area-inset-top));
Â  Â  Â  Â  Â  Â  padding-bottom: calc(1rem + env(safe-area-inset-bottom));
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Neumorphism Card Style */
Â  Â  Â  Â  .card-panel {
Â  Â  Â  Â  Â  Â  background-color: var(--bg-color);Â 
Â  Â  Â  Â  Â  Â  border-radius: 1.5rem;
Â  Â  Â  Â  Â  Â  box-shadow:Â 
Â  Â  Â  Â  Â  Â  Â  Â  8px 8px 16px var(--shadow-dark),Â 
Â  Â  Â  Â  Â  Â  Â  Â  -8px -8px 16px var(--shadow-light);Â 
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Primary Button Style */
Â  Â  Â  Â  .btn-main {
Â  Â  Â  Â  Â  Â  background-color: var(--primary-color);Â 
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  border-radius: 1rem;
Â  Â  Â  Â  Â  Â  box-shadow:Â 
Â  Â  Â  Â  Â  Â  Â  Â  4px 4px 8px rgba(4, 120, 87, 0.4),Â 
Â  Â  Â  Â  Â  Â  Â  Â  -2px -2px 4px rgba(255, 255, 255, 0.8);
Â  Â  Â  Â  Â  Â  transition: all 0.2s ease;
Â  Â  Â  Â  Â  Â  border: none;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn-main:hover { background-color: #069c67; color: white; }

Â  Â  Â  Â  .btn-main:active {
Â  Â  Â  Â  Â  Â  box-shadow:Â 
Â  Â  Â  Â  Â  Â  Â  Â  inset 3px 3px 7px rgba(0, 0, 0, 0.25),Â 
Â  Â  Â  Â  Â  Â  Â  Â  inset -3px -3px 7px rgba(255, 255, 255, 0.5);
Â  Â  Â  Â  Â  Â  transform: scale(0.97);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Input Field Style */
Â  Â  Â  Â  .input-recessed {
Â  Â  Â  Â  Â  Â  background-color: var(--bg-color);
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 1rem;
Â  Â  Â  Â  Â  Â  box-shadow:Â 
Â  Â  Â  Â  Â  Â  Â  Â  inset 3px 3px 7px rgba(0, 0, 0, 0.15),Â 
Â  Â  Â  Â  Â  Â  Â  Â  inset -3px -3px 7px var(--shadow-light);
Â  Â  Â  Â  Â  Â  padding: 1rem 1.25rem;
Â  Â  Â  Â  Â  Â  color: var(--text-color);
Â  Â  Â  Â  Â  Â  text-transform: uppercase;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- GAME AREA LAYOUT --- */
Â  Â  Â  Â  #game-area {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  background-color: #a7f3d0;Â 
Â  Â  Â  Â  Â  Â  box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.35);
Â  Â  Â  Â  Â  Â  flex-grow: 1;Â 
Â  Â  Â  Â  Â  Â  border-radius: 1.5rem;
Â  Â  Â  Â  Â  Â  min-height: 200px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- ITEM ANIMATIONS (à¹„à¸¡à¹ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡) --- */
Â  Â  Â  Â  .game-item {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  width: 60px;Â 
Â  Â  Â  Â  Â  Â  height: 60px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  user-select: none;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  background-color: rgba(255, 255, 255, 0.7);
Â  Â  Â  Â  Â  Â  box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.3), -2px -2px 4px rgba(255, 255, 255, 0.7);
Â  Â  Â  Â  Â  Â  transition: transform 0.05s ease-out;
Â  Â  Â  Â  Â  Â  z-index: 10;Â 

Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  transform: scale(0.5);Â 
Â  Â  Â  Â  Â  Â  animation: item-spawn 0.3s ease-out forwards;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes item-spawn {
Â  Â  Â  Â  Â  Â  from { opacity: 0; transform: scale(0.5) translateY(0); }
Â  Â  Â  Â  Â  Â  to { opacity: 1; transform: scale(1) translateY(0); }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Score Pop-up Style & Animation (à¹„à¸¡à¹ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡) */
Â  Â  Â  Â  .score-popup {
Â  Â  Â  Â  Â  Â  pointer-events: none;Â 
Â  Â  Â  Â  Â  Â  z-index: 20;Â 
Â  Â  Â  Â  Â  Â  text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);Â 
Â  Â  Â  Â  Â  Â  transition: all 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
Â  Â  Â  Â  Â  Â  will-change: transform, opacity, filter;
Â  Â  Â  Â  Â  Â  font-weight: 900;
Â  Â  Â  Â  }

Â  Â  Â  Â  .score-popup.animate {
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -130px) scale(1.5);
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  filter: blur(5px);Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- LEADERBOARD ENHANCEMENTS --- */
        #leaderboard-panel {
            max-height: 40vh; /* à¸ˆà¸³à¸à¸±à¸”à¸„à¸§à¸²à¸¡à¸ªà¸¹à¸‡à¸‚à¸­à¸‡ Leaderboard */
            overflow-y: auto;
            margin-top: 1rem;
            padding: 0.75rem; 
        }

        .leaderboard-item {
            border-radius: 0.75rem;
            margin-bottom: 0.5rem;
            padding: 0.75rem 1rem !important;
            transition: all 0.2s ease-in-out;
        }

        .leaderboard-rank-1 {
            background: linear-gradient(135deg, #FFD700 0%, #FFEB80 100%); /* Gold */
            box-shadow: 0 4px 8px rgba(255, 215, 0, 0.5);
            color: #614e1a !important;
        }
        .leaderboard-rank-2 {
            background: linear-gradient(135deg, #C0C0C0 0%, #E0E0E0 100%); /* Silver */
            color: #333 !important;
        }
        .leaderboard-rank-3 {
            background: linear-gradient(135deg, #CD7F32 0%, #F4A460 100%); /* Bronze */
            color: #333 !important;
        }
        
        .leaderboard-current-user {
            background-color: var(--primary-color) !important;
            color: white !important;
            border: 3px solid var(--secondary-color) !important;
            transform: scale(1.02);
            font-weight: bold; /* à¹€à¸à¸´à¹ˆà¸¡à¸„à¸§à¸²à¸¡à¸«à¸™à¸²à¹€à¸à¸·à¹ˆà¸­à¹€à¸™à¹‰à¸™ */
        }
        
        .leaderboard-current-user .leaderboard-score,
        .leaderboard-current-user .leaderboard-rank-text {
            color: white !important; /* à¹ƒà¸«à¹‰à¸„à¸°à¹à¸™à¸™à¹€à¸›à¹‡à¸™à¸ªà¸µà¸‚à¸²à¸§à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸›à¹‡à¸™à¸œà¸¹à¹‰à¹€à¸¥à¹ˆà¸™à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ */
        }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Responsive Text Size for smaller mobile screens */
Â  Â  Â  Â  @media (max-width: 370px) {
Â  Â  Â  Â  Â  Â  #app h1 { font-size: 1.35rem !important; }
Â  Â  Â  Â  Â  Â  .fs-6 { font-size: 0.75rem !important; }
Â  Â  Â  Â  Â  Â  .btn-main { font-size: 0.9rem !important; }
Â  Â  Â  Â  Â  Â  .game-item { width: 50px; height: 50px; }
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

Â  Â  <div id="app" class="d-flex flex-column vh-100 mx-auto">
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="modal fade" id="messageBox" tabindex="-1" aria-labelledby="messageBoxLabel" aria-hidden="true">
Â  Â  Â  Â  Â  <div class="modal-dialog modal-dialog-centered">
Â  Â  Â  Â  Â  Â  <div class="card-panel modal-content">
Â  Â  Â  Â  Â  Â  Â  <div class="modal-header border-0 pb-0">
Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="modal-title text-success fw-bold" id="messageTitle"></h5>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="modal-body pt-0 text-secondary">
Â  Â  Â  Â  Â  Â  Â  Â  <p id="messageBody"></p>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="modal-footer border-0 pt-0">
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn btn-main w-100 py-2" data-bs-dismiss="modal">à¸›à¸´à¸”</button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
Â  Â  Â  Â  Â  <div class="modal-dialog modal-dialog-scrollable modal-lg">
Â  Â  Â  Â  Â  Â  <div class="card-panel modal-content">
Â  Â  Â  Â  Â  Â  Â  <div class="modal-header border-bottom-0 pb-0">
Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="modal-title text-success fw-bold" id="infoModalLabel">ğŸ’¡ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸²à¸£à¸›à¸¥à¸”à¸›à¸¥à¹ˆà¸­à¸¢à¸„à¸²à¸£à¹Œà¸šà¸­à¸™</h5>
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="modal-body">
Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="h5 mt-3 mb-2 text-success">âœ… à¸ à¸²à¸£à¸à¸´à¸ˆà¸¥à¸”à¸„à¸²à¸£à¹Œà¸šà¸­à¸™ (Good Items: +10 à¸„à¸°à¹à¸™à¸™)</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="goodInfoList" class="space-y-3"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="h5 mt-4 mb-2 text-danger">âŒ à¸à¸²à¸£à¸›à¸¥à¹ˆà¸­à¸¢à¸„à¸²à¸£à¹Œà¸šà¸­à¸™ (Bad Items: -5 à¸„à¸°à¹à¸™à¸™)</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="badInfoList" class="space-y-3"></div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="modal-footer border-top-0 pt-0">
Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn btn-main w-100 py-3 fs-5" data-bs-dismiss="modal">à¸£à¸±à¸šà¸—à¸£à¸²à¸šà¹à¸¥à¸°à¹€à¸£à¸´à¹ˆà¸¡à¸ à¸²à¸£à¸à¸´à¸ˆ</button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="d-flex justify-content-between align-items-center mb-4 flex-shrink-0 mt-2">Â 
Â  Â  Â  Â  Â  Â  <h1 class="fs-4 fw-bolder text-success">ğŸŒ² CARBON MISSION ğŸŒ</h1>
Â  Â  Â  Â  Â  Â  <button id="info-button" class="btn btn-sm btn-info text-dark fw-bold shadow-sm" data-bs-toggle="modal" data-bs-target="#infoModal">à¸‚à¹‰à¸­à¸¡à¸¹à¸¥</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="start-screen" class="p-4 card-panel mb-3 flex-grow-1 d-flex flex-column justify-content-center align-items-center text-center">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <h2 class="display-6 fw-black text-primary mb-3">ğŸŒ± à¸«à¸¢à¸¸à¸”! à¸¡à¸¥à¸à¸´à¸©à¸„à¸²à¸£à¹Œà¸šà¸­à¸™!</h2>
Â  Â  Â  Â  Â  Â  <p class="fs-5 text-secondary fw-semibold mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  à¹à¸•à¸° **à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸£à¸±à¸à¸©à¹Œà¹‚à¸¥à¸** <span class="text-success">(+10)</span> à¹à¸¥à¸°à¸«à¸¥à¸µà¸à¹€à¸¥à¸µà¹ˆà¸¢à¸‡ **à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸›à¸¥à¹ˆà¸­à¸¢à¸„à¸²à¸£à¹Œà¸šà¸­à¸™** <span class="text-danger">(-5)</span>
Â  Â  Â  Â  Â  Â  </p>
            <div class="mb-4">
                <img src="https://i.postimg.cc/mD8q5v32/Earth-Mission.png" alt="Carbon Mission Logo" style="width: 150px; height: auto;">
            </div>

Â  Â  Â  Â  Â  Â  <div class="w-100" style="max-width: 300px;">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="employee-id" placeholder="à¸£à¸«à¸±à¸ªà¸à¸™à¸±à¸à¸‡à¸²à¸™ (A-Z, 0-9)"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maxlength="10"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="form-control mb-4 input-recessed fs-5">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="start-button"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="btn btn-main w-100 py-3 fs-5" disabled>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸£à¸«à¸±à¸ªà¸à¸™à¸±à¸à¸‡à¸²à¸™
Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="game-container" class="d-none flex-grow-1 d-flex flex-column">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="d-flex justify-content-between align-items-center p-3 card-panel mb-3 flex-shrink-0">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="fw-bold text-success fs-6">SCORE: <span id="score-display" class="fs-4 fw-bolder text-success">0</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="fw-bold text-success fs-6">TIME: <span id="timer-display" class="fs-4 fw-bolder text-primary">20</span>s</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="current-user-id" class="fs-6 text-muted text-truncate font-monospace" title="à¸£à¸«à¸±à¸ªà¸à¸™à¸±à¸à¸‡à¸²à¸™à¸‚à¸­à¸‡à¸„à¸¸à¸“">ID: </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="game-area" class="flex-grow-1 position-relative">
Â  Â  Â  Â  Â  Â  Â  Â  <p id="game-message" class="position-absolute top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center fs-4 fw-bold text-danger bg-dark bg-opacity-10 rounded-3 d-none"></p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="game-over-screen" class="d-none text-center p-3 card-panel mb-3 flex-shrink-0">
Â  Â  Â  Â  Â  Â  <h2 class="fs-3 fw-bolder text-success">ğŸ‰ à¸ à¸²à¸£à¸à¸´à¸ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ!</h2>
Â  Â  Â  Â  Â  Â  <p class="fs-5 text-secondary">à¸„à¸°à¹à¸™à¸™à¸ªà¸¸à¸”à¸—à¹‰à¸²à¸¢: <span id="final-score" class="d-block fw-black display-4 text-danger my-2">0</span></p>
Â  Â  Â  Â  Â  Â  <p id="ranking-status" class="fs-6 fw-semibold text-success"></p>
Â  Â  Â  Â  Â  Â  <button id="restart-button"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="btn btn-main w-100 py-3 fs-5">
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ” à¹€à¸¥à¹ˆà¸™à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="leaderboard-panel" class="card-panel flex-shrink-0">
Â  Â  Â  Â  Â  Â  <h2 class="fs-6 fw-bold text-center mb-2 text-success">ğŸ† MISSION LEADERBOARD (à¸„à¸°à¹à¸™à¸™à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”)</h2>
Â  Â  Â  Â  Â  Â  <div id="leaderboard-list">
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-center text-muted" id="loading-leaderboard">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸­à¸±à¸™à¸”à¸±à¸š...</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

Â  Â  <script>
Â  Â  Â  Â  // --- Game Configuration (Constants) ---
Â  Â  Â  Â  const GAME_DURATION = 20;Â 
Â  Â  Â  Â  const SPAWN_INTERVAL = 300;Â 
Â  Â  Â  Â  const ITEM_SPEED = 2;Â 
Â  Â  Â  Â  const ITEM_SIZE = 60;Â 
Â  Â  Â  Â  const SCORE_REDUCTION = 10;
Â  Â  Â  Â  const SCORE_EMISSION = -5;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Modal instances for BootstrapÂ 
Â  Â  Â  Â  let messageModal;
Â  Â  Â  Â  let infoModal;

Â  Â  Â  Â  // Emoji definitions (à¹ƒà¸Šà¹‰à¸Šà¸¸à¸”à¹€à¸”à¸´à¸¡)
Â  Â  Â  Â  const ITEM_DEFINITIONS = [
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/hGngkwQL/1.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¹€à¸¥à¸·à¸­à¸à¸—à¸²à¸™à¸­à¸²à¸«à¸²à¸£à¸¡à¸±à¸‡à¸ªà¸§à¸´à¸£à¸±à¸•à¸´' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/k41mtg1F/10.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¹ƒà¸Šà¹‰à¸£à¸°à¸šà¸šà¸‚à¸™à¸ªà¹ˆà¸‡à¸ªà¸²à¸˜à¸²à¸£à¸“à¸°' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/qqNdcHWH/11.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¸›à¸¥à¸¹à¸à¸•à¹‰à¸™à¹„à¸¡à¹‰à¹€à¸à¸´à¹ˆà¸¡à¸à¸·à¹‰à¸™à¸—à¸µà¹ˆà¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/TwYxwD9y/12.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¹ƒà¸Šà¹‰à¸à¸¥à¸±à¸‡à¸‡à¸²à¸™à¸ªà¸°à¸­à¸²à¸” (à¹‚à¸‹à¸¥à¸²à¸£à¹Œà¹€à¸‹à¸¥à¸¥à¹Œ)' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/ydQHS8Qd/13.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¸¥à¸”à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸–à¸¸à¸‡à¸à¸¥à¸²à¸ªà¸•à¸´à¸' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/ZR7Sy576/14.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¸™à¸³à¸‚à¸§à¸”à¸™à¹‰à¸³à¸¡à¸²à¹ƒà¸Šà¹‰à¸‹à¹‰à¸³' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/0QWsJyWV/15.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¸‹à¹ˆà¸­à¸¡à¹à¸‹à¸¡à¸­à¸¸à¸›à¸à¸£à¸“à¹Œà¹„à¸Ÿà¸Ÿà¹‰à¸²à¸—à¸µà¹ˆà¸Šà¸³à¸£à¸¸à¸”' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/3RSTDxSb/16.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¸›à¸´à¸”à¹„à¸Ÿà¹€à¸¡à¸·à¹ˆà¸­à¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰à¸‡à¸²à¸™' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/D0SKQ3H5/17.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¹à¸¢à¸à¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¸¢à¸°à¸à¹ˆà¸­à¸™à¸—à¸´à¹‰à¸‡' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/k5y9qcWv/2.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¸›à¸£à¸°à¸«à¸¢à¸±à¸”à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸™à¹‰à¸³' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/PqMhT41M/3.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¸‹à¸·à¹‰à¸­à¸ªà¸´à¸™à¸„à¹‰à¸²à¸¡à¸·à¸­à¸ªà¸­à¸‡' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/9fBVCpyL/4.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¸à¸²à¸£à¹€à¸”à¸´à¸™/à¸›à¸±à¹ˆà¸™à¸ˆà¸±à¸à¸£à¸¢à¸²à¸™à¹à¸—à¸™à¸£à¸–' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/0NCxPf7n/5.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¹ƒà¸Šà¹‰à¸œà¸¥à¸´à¸•à¸ à¸±à¸“à¸‘à¹Œà¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¸¡à¸´à¸•à¸£à¸•à¹ˆà¸­à¸ªà¸´à¹ˆà¸‡à¹à¸§à¸”à¸¥à¹‰à¸­à¸¡' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/rp9cMJS6/6.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¸‡à¸”à¹€à¸œà¸²à¸‚à¸¢à¸°' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/g0KdmD35/7.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¸à¸²à¸£à¸›à¸¥à¸¹à¸à¸œà¸±à¸à¸ªà¸§à¸™à¸„à¸£à¸±à¸§' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/fbvZDKxN/8.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¸šà¸£à¸´à¸ˆà¸²à¸„à¹€à¸ªà¸·à¹‰à¸­à¸œà¹‰à¸²/à¸‚à¸­à¸‡à¹ƒà¸Šà¹‰à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰à¹à¸¥à¹‰à¸§' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/vmvMbzWF/9.png', type: 'good', score: SCORE_REDUCTION, color: 'bg-success-subtle', defaultDesc: 'à¹ƒà¸Šà¹‰à¸œà¹‰à¸²à¹€à¸Šà¹‡à¸”à¸¡à¸·à¸­à¹à¸—à¸™à¸à¸£à¸°à¸”à¸²à¸©à¸—à¸´à¸Šà¸Šà¸¹à¹ˆ' },

Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/qqWHjZdq/18.png', type: 'bad', score: SCORE_EMISSION, color: 'bg-danger-subtle', defaultDesc: 'à¹€à¸”à¸´à¸™à¸—à¸²à¸‡à¸”à¹‰à¸§à¸¢à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸šà¸´à¸™à¸šà¹ˆà¸­à¸¢' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/sxbCw0RQ/19.png', type: 'bad', score: SCORE_EMISSION, color: 'bg-danger-subtle', defaultDesc: 'à¹ƒà¸Šà¹‰à¸£à¸–à¸¢à¸™à¸•à¹Œà¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§à¸„à¸™à¹€à¸”à¸µà¸¢à¸§' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/1X8Z01bQ/20.png', type: 'bad', score: SCORE_EMISSION, color: 'bg-danger-subtle', defaultDesc: 'à¸—à¸´à¹‰à¸‡à¸‚à¸¢à¸°à¹„à¸¡à¹ˆà¹à¸¢à¸à¸›à¸£à¸°à¹€à¸ à¸—' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/Vv2PDHcB/21.png', type: 'bad', score: SCORE_EMISSION, color: 'bg-danger-subtle', defaultDesc: 'à¹€à¸›à¸´à¸”à¹„à¸Ÿà¸—à¸´à¹‰à¸‡à¹„à¸§à¹‰à¸•à¸¥à¸­à¸”à¹€à¸§à¸¥à¸²' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/4yjRBFTV/22.png', type: 'bad', score: SCORE_EMISSION, color: 'bg-danger-subtle', defaultDesc: 'à¸ªà¸±à¹ˆà¸‡à¸­à¸²à¸«à¸²à¸£à¹à¸šà¸š Delivery à¸šà¹ˆà¸­à¸¢à¹€à¸à¸´à¸™à¹„à¸›' },
Â  Â  Â  Â  Â  Â  { imageSrc: 'https://i.postimg.cc/7hjrmQy3/23.png', type: 'bad', score: SCORE_EMISSION, color: 'bg-danger-subtle', defaultDesc: 'à¹ƒà¸Šà¹‰à¸™à¹‰à¸³à¹€à¸›à¸¥à¸·à¸­à¸‡/à¹€à¸›à¸´à¸”à¸—à¸´à¹‰à¸‡à¹„à¸§à¹‰' },Â 
Â  Â  Â  Â  ];

Â  Â  Â  Â  // --- Global Game State ---
Â  Â  Â  Â  let gameState = {
Â  Â  Â  Â  Â  Â  isImagesPreloaded: false,
Â  Â  Â  Â  Â  Â  isRunning: false,
Â  Â  Â  Â  Â  Â  score: 0,
Â  Â  Â  Â  Â  Â  timeLeft: GAME_DURATION,
Â  Â  Â  Â  Â  Â  employeeId: '',
Â  Â  Â  Â  Â  Â  items: {},Â 
Â  Â  Â  Â  Â  Â  itemIdCounter: 0,
Â  Â  Â  Â  Â  Â  animationFrameId: null,
Â  Â  Â  Â  Â  Â  spawnIntervalId: null,
Â  Â  Â  Â  Â  Â  timerIntervalId: null,
Â  Â  Â  Â  Â  Â  db: null,
Â  Â  Â  Â  Â  Â  userId: null,
Â  Â  Â  Â  Â  Â  appId: null,
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- DOM Elements ---
Â  Â  Â  Â  const dom = {
Â  Â  Â  Â  Â  Â  startScreen: document.getElementById('start-screen'),
Â  Â  Â  Â  Â  Â  gameContainer: document.getElementById('game-container'),
Â  Â  Â  Â  Â  Â  gameOverScreen: document.getElementById('game-over-screen'),
Â  Â  Â  Â  Â  Â  gameArea: document.getElementById('game-area'),
Â  Â  Â  Â  Â  Â  employeeIdInput: document.getElementById('employee-id'),
Â  Â  Â  Â  Â  Â  startButton: document.getElementById('start-button'),
Â  Â  Â  Â  Â  Â  restartButton: document.getElementById('restart-button'),
Â  Â  Â  Â  Â  Â  scoreDisplay: document.getElementById('score-display'),
Â  Â  Â  Â  Â  Â  timerDisplay: document.getElementById('timer-display'),
Â  Â  Â  Â  Â  Â  finalScore: document.getElementById('final-score'),
Â  Â  Â  Â  Â  Â  gameMessage: document.getElementById('game-message'),
Â  Â  Â  Â  Â  Â  leaderboardPanel: document.getElementById('leaderboard-panel'),Â 
Â  Â  Â  Â  Â  Â  leaderboardList: document.getElementById('leaderboard-list'),
Â  Â  Â  Â  Â  Â  loadingLeaderboard: document.getElementById('loading-leaderboard'),
Â  Â  Â  Â  Â  Â  rankingStatus: document.getElementById('ranking-status'),
Â  Â  Â  Â  Â  Â  currentUserId: document.getElementById('current-user-id'),
Â  Â  Â  Â  Â  Â  infoButton: document.getElementById('info-button'),Â  Â  Â 
Â  Â  Â  Â  Â  Â  goodInfoList: document.getElementById('goodInfoList'),Â 
Â  Â  Â  Â  Â  Â  badInfoList: document.getElementById('badInfoList'),
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ***************************************************************
Â  Â  Â  Â  // --- Game Logic Functions ---
Â  Â  Â  Â  // ***************************************************************
Â  Â  Â  Â Â 
Â  Â  Â  Â  function showMessage(title, body) {
Â  Â  Â  Â  Â  Â  document.getElementById('messageTitle').textContent = title;
Â  Â  Â  Â  Â  Â  document.getElementById('messageBody').textContent = body;
Â  Â  Â  Â  Â  Â  messageModal.show();
Â  Â  Â  Â  }

Â  Â  Â  Â  function resetGame() {
Â  Â  Â  Â  Â  Â  gameState.score = 0;
Â  Â  Â  Â  Â  Â  gameState.timeLeft = GAME_DURATION;
Â  Â  Â  Â  Â  Â  Object.values(gameState.items).forEach(item => item.element.remove());
Â  Â  Â  Â  Â  Â  gameState.items = {};Â 
Â  Â  Â  Â  Â  Â  gameState.itemIdCounter = 0;
Â  Â  Â  Â  Â  Â  dom.scoreDisplay.textContent = '0';
Â  Â  Â  Â  Â  Â  dom.timerDisplay.textContent = GAME_DURATION;
Â  Â  Â  Â  Â  Â  dom.gameMessage.classList.add('d-none');
Â  Â  Â  Â  Â  Â  dom.timerDisplay.classList.remove('text-danger');
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function startGame() {
Â  Â  Â  Â  Â  Â  if (!gameState.employeeId) {
Â  Â  Â  Â  Â  Â  Â  Â  gameState.employeeId = dom.employeeIdInput.value.toUpperCase().trim();
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (!gameState.employeeId) {
Â  Â  Â  Â  Â  Â  Â  Â  Â showMessage("à¸£à¸«à¸±à¸ªà¸à¸™à¸±à¸à¸‡à¸²à¸™à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡", "à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸£à¸«à¸±à¸ªà¸à¸™à¸±à¸à¸‡à¸²à¸™à¸à¹ˆà¸­à¸™à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸à¸¡");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  resetGame();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // à¸‹à¹ˆà¸­à¸™ Start/Game OverÂ 
Â  Â  Â  Â  Â  Â  dom.startScreen.classList.add('d-none');
Â  Â  Â  Â  Â  Â  dom.gameOverScreen.classList.add('d-none');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // à¹à¸ªà¸”à¸‡ Game Container
Â  Â  Â  Â  Â  Â  dom.gameContainer.classList.remove('d-none');Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  dom.currentUserId.textContent = `ID: ${gameState.employeeId}`;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  startActualGame();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function startActualGame() {
Â  Â  Â  Â  Â  Â  gameState.isRunning = true;
Â  Â  Â  Â  Â  Â  gameState.spawnIntervalId = setInterval(spawnItem, SPAWN_INTERVAL);
Â  Â  Â  Â  Â  Â  gameState.timerIntervalId = setInterval(updateTimer, 1000);

Â  Â  Â  Â  Â  Â  gameState.animationFrameId = requestAnimationFrame(gameLoop);
Â  Â  Â  Â  }


Â  Â  Â  Â  function endGame() {
Â  Â  Â  Â  Â  Â  gameState.isRunning = false;
Â  Â  Â  Â  Â  Â  cancelAnimationFrame(gameState.animationFrameId);
Â  Â  Â  Â  Â  Â  clearInterval(gameState.spawnIntervalId);
Â  Â  Â  Â  Â  Â  clearInterval(gameState.timerIntervalId);

Â  Â  Â  Â  Â  Â  Object.values(gameState.items).forEach(item => item.element.remove());Â 
Â  Â  Â  Â  Â  Â  gameState.items = {};Â 

Â  Â  Â  Â  Â  Â  // à¸‹à¹ˆà¸­à¸™ Game Container à¹à¸¥à¸°à¹à¸ªà¸”à¸‡ Game Over Screen
Â  Â  Â  Â  Â  Â  dom.gameContainer.classList.add('d-none');
Â  Â  Â  Â  Â  Â  dom.finalScore.textContent = gameState.score;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  dom.gameOverScreen.classList.remove('d-none');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  saveScore(gameState.employeeId, gameState.score, gameState.userId);
Â  Â  Â  Â  }

Â  Â  Â  Â  function updateTimer() {
Â  Â  Â  Â  Â  Â  gameState.timeLeft--;
Â  Â  Â  Â  Â  Â  dom.timerDisplay.textContent = gameState.timeLeft;

Â  Â  Â  Â  Â  Â  if (gameState.timeLeft <= 5) {
Â  Â  Â  Â  Â  Â  Â  Â  dom.timerDisplay.classList.add('text-danger');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  dom.timerDisplay.classList.remove('text-danger');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (gameState.timeLeft <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  endGame();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function spawnItem() {
Â  Â  Â  Â  Â  Â  const definition = ITEM_DEFINITIONS[Math.floor(Math.random() * ITEM_DEFINITIONS.length)];
Â  Â  Â  Â  Â  Â  const gameAreaWidth = dom.gameArea.clientWidth;
Â  Â  Â  Â  Â  Â  const itemId = gameState.itemIdCounter++;

Â  Â  Â  Â  Â  Â  const itemElement = document.createElement('div');
Â  Â  Â  Â  Â  Â  itemElement.addEventListener('click', handleItemClick);
Â  Â  Â  Â  Â  Â  itemElement.addEventListener('touchstart', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();Â 
Â  Â  Â  Â  Â  Â  Â  Â  handleItemClick(e.touches[0]);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  itemElement.className = `game-item`;Â 
Â  Â  Â  Â  Â  Â  itemElement.dataset.id = itemId;Â 
Â  Â  Â  Â  Â  Â  itemElement.dataset.type = definition.type;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const imgElement = document.createElement('img');
Â  Â  Â  Â  Â  Â  imgElement.src = definition.imageSrc;
Â  Â  Â  Â  Â  Â  imgElement.className = "w-100 h-100 object-fit-contain p-2";Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  itemElement.appendChild(imgElement);

Â  Â  Â  Â  Â  Â  const itemSize = ITEM_SIZE;Â 
Â  Â  Â  Â  Â  Â  const posX = Math.random() * (gameAreaWidth - itemSize);
Â  Â  Â  Â  Â  Â  itemElement.style.left = `${posX}px`;
Â  Â  Â  Â  Â  Â  itemElement.style.top = `-${ITEM_SIZE}px`;Â 

Â  Â  Â  Â  Â  Â  dom.gameArea.appendChild(itemElement);

Â  Â  Â  Â  Â  Â  const item = {
Â  Â  Â  Â  Â  Â  Â  Â  id: itemId,
Â  Â  Â  Â  Â  Â  Â  Â  definition: definition,
Â  Â  Â  Â  Â  Â  Â  Â  element: itemElement,
Â  Â  Â  Â  Â  Â  Â  Â  y: -ITEM_SIZE,Â 
Â  Â  Â  Â  Â  Â  Â  Â  x: posX,
Â  Â  Â  Â  Â  Â  Â  Â  speed: ITEM_SPEED + Math.random() * 1.5Â 
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  gameState.items[itemId] = item;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function handleItemClick(event) {
Â  Â  Â  Â  Â  Â  if (!gameState.isRunning) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const clickedItem = event.target.closest('.game-item');Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (clickedItem) {
Â  Â  Â  Â  Â  Â  Â  Â  const itemId = parseInt(clickedItem.dataset.id);
Â  Â  Â  Â  Â  Â  Â  Â  const item = gameState.items[itemId];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!item) return;

Â  Â  Â  Â  Â  Â  Â  Â  const scoreChange = item.definition.score;

Â  Â  Â  Â  Â  Â  Â  Â  gameState.score += scoreChange;
Â  Â  Â  Â  Â  Â  Â  Â  dom.scoreDisplay.textContent = gameState.score;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const rect = dom.gameArea.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  Â  Â  const itemRect = clickedItem.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const xPos = `${itemRect.left - rect.left + itemRect.width / 2}px`;
Â  Â  Â  Â  Â  Â  Â  Â  const yPos = `${itemRect.top - rect.top + itemRect.height / 2}px`;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  clickedItem.remove();Â 
Â  Â  Â  Â  Â  Â  Â  Â  delete gameState.items[itemId];Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  showScoreChange(xPos, yPos, scoreChange);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function showScoreChange(x, y, score) {
Â  Â  Â  Â  Â  Â  const popup = document.createElement('div');
Â  Â  Â  Â  Â  Â  popup.textContent = score > 0 ? `+${score}` : `${score}`;
Â  Â  Â  Â  Â  Â  popup.className = `score-popup position-absolute fs-4 text-center`;Â 
Â  Â  Â  Â  Â  Â  popup.style.left = x;
Â  Â  Â  Â  Â  Â  popup.style.top = y;
Â  Â  Â  Â  Â  Â  popup.style.transform = 'translate(-50%, -50%)';Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (score > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  popup.classList.add('text-success');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  popup.classList.add('text-danger');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  dom.gameArea.appendChild(popup);

Â  Â  Â  Â  Â  Â  requestAnimationFrame(() => {
Â  Â  Â  Â  Â  Â  Â  Â  popup.classList.add('animate');
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  popup.remove();
Â  Â  Â  Â  Â  Â  }, 600);
Â  Â  Â  Â  }

Â  Â  Â  Â  function gameLoop() {
Â  Â  Â  Â  Â  Â  if (!gameState.isRunning) return;

Â  Â  Â  Â  Â  Â  const gameAreaHeight = dom.gameArea.clientHeight;

Â  Â  Â  Â  Â  Â  const itemIds = Object.keys(gameState.items);

Â  Â  Â  Â  Â  Â  for (let i = 0; i < itemIds.length; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  const itemId = itemIds[i];
Â  Â  Â  Â  Â  Â  Â  Â  const item = gameState.items[itemId];

Â  Â  Â  Â  Â  Â  Â  Â  if (!item) continue;Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  item.y += item.speed;
Â  Â  Â  Â  Â  Â  Â  Â  item.element.style.top = `${item.y}px`;

Â  Â  Â  Â  Â  Â  Â  Â  if (item.y > gameAreaHeight) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (item.definition.type === 'good') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gameState.score -= 5;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.scoreDisplay.textContent = gameState.score;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showScoreChange(item.element.style.left, item.element.style.top, -5);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.element.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  delete gameState.items[itemId];Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  gameState.animationFrameId = requestAnimationFrame(gameLoop);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- Firebase/Leaderboard Logic ---
Â  Â  Â  Â  async function fetchWithBackoff(func, retries = 5) {
Â  Â  Â  Â  Â  Â  for (let i = 0; i < retries; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return await func();
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (i === retries - 1 || error.code !== 'unavailable') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw error;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await new Promise(resolve => setTimeout(resolve, (2 ** i) * 1000));
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function getCollectionPath(appId) {
Â  Â  Â  Â  Â  Â  return `artifacts/${appId}/public/data/carbon_game_rankings`;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  async function saveScore(employeeId, score, userId) {
Â  Â  Â  Â  Â  Â  if (!gameState.db || !gameState.appId) {
Â  Â  Â  Â  Â  Â  Â  Â  dom.rankingStatus.textContent = "âš ï¸ Firebase à¹„à¸¡à¹ˆà¸à¸£à¹‰à¸­à¸¡ Score à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸šà¸±à¸™à¸—à¸¶à¸";
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const docRef = window.firestore.collection(gameState.db, getCollectionPath(gameState.appId));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await fetchWithBackoff(() => window.firestore.addDoc(docRef, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  employeeId: employeeId,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  score: score,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId: userId,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: new Date()
Â  Â  Â  Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  Â  Â  Â  Â  dom.rankingStatus.textContent = "à¸„à¸°à¹à¸™à¸™à¸–à¸¹à¸à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§!";
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  dom.rankingStatus.textContent = "âš ï¸ à¸šà¸±à¸™à¸—à¸¶à¸à¸„à¸°à¹à¸™à¸™à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function setupLeaderboard(appId) {
Â  Â  Â  Â  Â  Â  if (!gameState.db) {
Â  Â  Â  Â  Â  Â  Â  Â  dom.leaderboardList.innerHTML = `<p class="text-center text-danger">Firebase Database à¹„à¸¡à¹ˆà¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™!</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  dom.loadingLeaderboard.classList.remove('d-none');

Â  Â  Â  Â  Â  Â  const rankingsQuery = window.firestore.query(
Â  Â  Â  Â  Â  Â  Â  Â  window.firestore.collection(gameState.db, getCollectionPath(appId)),
Â  Â  Â  Â  Â  Â  Â  Â  window.firestore.orderBy("timestamp", "desc")Â 
Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  window.firestore.onSnapshot(rankingsQuery, (snapshot) => {
Â  Â  Â  Â  Â  Â  Â  Â  const leaderboard = snapshot.docs.map(doc => ({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: doc.id,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ...doc.data()
Â  Â  Â  Â  Â  Â  Â  Â  }));

Â  Â  Â  Â  Â  Â  Â  Â  const aggregatedScores = leaderboard.reduce((acc, item) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const id = item.employeeId;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!acc[id]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  acc[id] = { employeeId: id, score: 0 };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  acc[id].score += (item.score || 0);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return acc;
Â  Â  Â  Â  Â  Â  Â  Â  }, {});

Â  Â  Â  Â  Â  Â  Â  Â  const topScores = Object.values(aggregatedScores)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .sort((a, b) => b.score - a.score)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .slice(0, 10);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  dom.loadingLeaderboard.classList.add('d-none');
Â  Â  Â  Â  Â  Â  Â  Â  dom.leaderboardList.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (topScores.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â dom.leaderboardList.innerHTML = `<p class="text-center text-muted p-2">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¹ƒà¸„à¸£à¸—à¸³à¸„à¸°à¹à¸™à¸™à¹€à¸¥à¸¢! à¸¡à¸²à¹€à¸›à¹‡à¸™à¸„à¸™à¹à¸£à¸à¸à¸±à¸™!</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  topScores.forEach((rank, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const rankItem = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isCurrentUser = rank.employeeId === gameState.employeeId;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const rankNumber = index + 1;
                    
                    let rankClass = 'text-secondary';
                    let rankDisplay = `#${rankNumber}`;

                    // à¸à¸³à¸«à¸™à¸” Class à¹à¸¥à¸° Emoji à¸ªà¸³à¸«à¸£à¸±à¸š 3 à¸­à¸±à¸™à¸”à¸±à¸šà¹à¸£à¸
                    if (rankNumber === 1) {
                        rankClass = 'leaderboard-rank-1 fw-black fs-5';
                        rankDisplay = 'ğŸ¥‡';
                    } else if (rankNumber === 2) {
                        rankClass = 'leaderboard-rank-2 fw-bold fs-5';
                        rankDisplay = 'ğŸ¥ˆ';
                    } else if (rankNumber === 3) {
                        rankClass = 'leaderboard-rank-3 fw-semibold fs-5';
                        rankDisplay = 'ğŸ¥‰';
                    } else {
                        rankClass = 'bg-light'; // à¸ªà¸³à¸«à¸£à¸±à¸šà¸­à¸±à¸™à¸”à¸±à¸šà¸—à¸µà¹ˆ 4 à¸¥à¸‡à¹„à¸›
                    }

                    // à¸ªà¸£à¹‰à¸²à¸‡ HTML à¸ à¸²à¸¢à¹ƒà¸™
                    rankItem.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="leaderboard-rank-text me-3" style="min-width: 30px;">${rankDisplay}</span>
                            <span class="text-truncate fw-bold flex-grow-1">${rank.employeeId}</span>
                            <span class="leaderboard-score fw-black fs-5 ms-3 text-primary">${rank.score}</span>
                        </div>
                    `;

                    // à¸à¸³à¸«à¸™à¸”à¸„à¸¥à¸²à¸ªà¸£à¸§à¸¡
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rankItem.className = `d-flex align-items-center leaderboard-item small ${rankClass} ${isCurrentUser ? 'leaderboard-current-user' : ''}`;
                    
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.leaderboardList.appendChild(rankItem);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Initialization and Event Handlers ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  function populateInfoModal() {
Â  Â  Â  Â  Â  Â  const goodItems = ITEM_DEFINITIONS.filter(item => item.type === 'good');
Â  Â  Â  Â  Â  Â  const badItems = ITEM_DEFINITIONS.filter(item => item.type === 'bad');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  dom.goodInfoList.innerHTML = goodItems.map(item => `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="d-flex align-items-center mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${item.imageSrc}" style="width: 35px; height: 35px; border-radius: 50%; padding: 5px; background: rgba(0, 255, 0, 0.1);" class="me-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-success small fw-semibold">${item.defaultDesc}</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `).join('');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  dom.badInfoList.innerHTML = badItems.map(item => `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="d-flex align-items-center mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${item.imageSrc}" style="width: 35px; height: 35px; border-radius: 50%; padding: 5px; background: rgba(255, 0, 0, 0.1);" class="me-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-danger small fw-semibold">${item.defaultDesc}</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `).join('');
Â  Â  Â  Â  }

Â  Â  Â  Â  function initialize() {
Â  Â  Â  Â  Â  Â  messageModal = new bootstrap.Modal(document.getElementById('messageBox'));
Â  Â  Â  Â  Â  Â  infoModal = new bootstrap.Modal(document.getElementById('infoModal'));
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  populateInfoModal();

Â  Â  Â  Â  Â  Â  dom.startButton.addEventListener('click', startGame);
Â  Â  Â  Â  Â  Â  dom.restartButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  dom.gameOverScreen.classList.add('d-none');
Â  Â  Â  Â  Â  Â  Â  Â  dom.startScreen.classList.remove('d-none'); // à¸à¸¥à¸±à¸šà¹„à¸›à¸«à¸™à¹‰à¸²à¹à¸£à¸à¹€à¸à¸·à¹ˆà¸­à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ ID à¸«à¸£à¸·à¸­à¹€à¸£à¸´à¹ˆà¸¡à¹ƒà¸«à¸¡à¹ˆ
                dom.employeeIdInput.disabled = false;
                dom.startButton.disabled = true;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  dom.employeeIdInput.addEventListener('input', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  const value = e.target.value.toUpperCase().trim();
Â  Â  Â  Â  Â  Â  Â  Â  e.target.value = value;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (value.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.startButton.textContent = 'ğŸš€ à¹€à¸£à¸´à¹ˆà¸¡à¸ à¸²à¸£à¸à¸´à¸ˆ!';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.startButton.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.startButton.textContent = 'à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸£à¸«à¸±à¸ªà¸à¸™à¸±à¸à¸‡à¸²à¸™';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dom.startButton.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  gameState.employeeId = value;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // Global function called by the Firebase module when ready
Â  Â  Â  Â  window.initApp = (userId, appId) => {
Â  Â  Â  Â  Â  Â  gameState.userId = userId;
Â  Â  Â  Â  Â  Â  gameState.appId = appId;
Â  Â  Â  Â  Â  Â  gameState.db = window.db; 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (gameState.appId) {
Â  Â  Â  Â  Â  Â  Â  Â  setupLeaderboard(gameState.appId);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  dom.loadingLeaderboard.textContent = "à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ Firebase à¹„à¸”à¹‰";
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Firebase App ID not available for Leaderboard setup.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  initialize();
Â  Â  Â  Â  };

Â  Â  </script>
</body>
</html>
